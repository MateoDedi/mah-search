<%- include('partials/header'); -%>

  <ul class="jobs">

  </ul>

  <%- include('partials/footer'); -%>

    <script>
      async function fetchData() {
        try {
          const response = await fetch('/list-jobs');
          const data = await response.json();
          console.log(data);
          const jobsList = document.querySelector('.jobs');

          data.forEach(job => {
            const listItem = document.createElement('li');
            listItem.classList.add('recipe');

            const date = document.createElement('p');
            const dateObj = new Date(job.date);
            const day = dateObj.getDate();
            const month = dateObj.getMonth() + 1;
            const year = dateObj.getFullYear();
            date.textContent = `${day}/${month}/${year}`;

            const title = document.createElement('h4');
            title.textContent = job.jobTitle;

            const company = document.createElement('p');
            company.textContent = job.company;

            const del = document.createElement('button');
            del.classList.add('delete');
            del.textContent = 'Delete';
            del.setAttribute('data-id', job._id);

            listItem.appendChild(title, company, deleteButton);
            jobsList.appendChild(listItem);
          });

        } catch (error) {
          console.error('Error fetching data:', error);
        }
      }

      // delete profile
      //const deleteButton = document.querySelector('.delete');
      deleteButton.addEventListener('click', async () => {
        if (e.target.matches('.delete')) {
          try {
            const res = await fetch('/job', {
              method: 'DELETE',
              body: JSON.stringify({ _id: e.target.dataset.id }),
              headers: { 'Content-Type': 'application/json' }
            });
            const data = await res.json();
            console.log(data);
          }
          catch (err) {
            console.log(err);
          }
        }
      });

      fetchData();
    </script>